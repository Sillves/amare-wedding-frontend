# TypeScript OpenAPI Integration

This project uses **automatic type generation** from the OpenAPI specification to ensure 100% type safety between frontend and backend.

## ‚ö° Quick Start

```bash
# Fullstack devs: Sync types from running backend (recommended!)
npm run sync-types

# Or fetch + generate separately:
npm run fetch-openapi    # Fetch from backend
npm run generate-types   # Generate TypeScript types
```

## üéØ Overview

All API types are auto-generated from `openapi.json` using `openapi-typescript`. This provides:

- ‚úÖ **100% accuracy** - Types always match your backend API
- ‚úÖ **Zero maintenance** - No manual type updates needed
- ‚úÖ **Compile-time safety** - Catch API mismatches before runtime
- ‚úÖ **IntelliSense** - Full autocomplete for all API types

## üìÅ Generated Files

- **`src/types/api.ts`** - Auto-generated TypeScript definitions from OpenAPI spec
  - ‚ö†Ô∏è **DO NOT EDIT THIS FILE MANUALLY**
  - It is regenerated from `openapi.json`

## üîÑ Automated Type Sync (Recommended for Fullstack Devs)

**The easiest way** - Automatically fetch OpenAPI spec from your running backend and generate types:

```bash
# Fetch OpenAPI from backend + Generate TypeScript types (all in one)
npm run sync-types
```

This single command will:
1. ‚úÖ Fetch `openapi.json` from your running backend
2. ‚úÖ Generate TypeScript types automatically
3. ‚úÖ No manual copy-paste needed!

### Configuration

The script automatically detects your backend URL from `.env.local`. Default: `http://localhost:5072`

**Common ASP.NET Core Swagger endpoints:**
- `http://localhost:5072/swagger/v1/swagger.json` (default)
- `http://localhost:5072/swagger.json`
- Custom endpoint via `OPENAPI_ENDPOINT` env variable

**To customize**, add to `.env.local`:

```bash
# Backend base URL (if different from default)
BACKEND_URL=http://localhost:5072

# Custom OpenAPI endpoint path (optional)
OPENAPI_ENDPOINT=/swagger/v1/swagger.json
```

### Individual Commands

```bash
# Just fetch OpenAPI spec from backend
npm run fetch-openapi

# Just generate types from openapi.json
npm run generate-types

# Do both (recommended)
npm run sync-types
```

### Workflow for Fullstack Developers

1. Make changes to your ASP.NET Core backend
2. Run your backend (F5 in Rider/Visual Studio)
3. In frontend, run: `npm run sync-types`
4. Done! Frontend types are now in sync

**When to run this:**
- After making backend API changes
- Before starting work on new features that use new endpoints
- When you get type errors that indicate API mismatch

## üìù Using Generated Types

### Auth Types Example

```typescript
import type { components } from '@/types/api';

// Use generated types
type LoginRequest = components['schemas']['LoginRequest'];
type AuthResponse = components['schemas']['AuthResponse'];
```

### Wedding Types Example

```typescript
import type { components } from '@/types/api';

type WeddingDto = components['schemas']['WeddingDto'];
type CreateWeddingRequest = components['schemas']['CreateWeddingRequestDto'];
```

## üèóÔ∏è Type Structure

The generated file exports two main interfaces:

1. **`paths`** - All API endpoints with request/response types
2. **`components`** - All schema definitions (DTOs, models, enums)

### Accessing Schema Types

```typescript
components['schemas']['TypeName'];
```

### Accessing Endpoint Types

```typescript
paths['/api/endpoint']['post']['requestBody']['content']['application/json'];
```

## üîß Current Implementation

All feature modules import from the generated types:

- **Auth** - [src/features/auth/types/index.ts](src/features/auth/types/index.ts)
- **Weddings** - [src/features/weddings/types/index.ts](src/features/weddings/types/index.ts)

These files re-export and augment the generated types as needed.

## üöÄ Best Practices

1. **Never edit `src/types/api.ts`** - It's auto-generated
2. **Commit `src/types/api.ts`** to git for team consistency
3. **Run `npm run generate-types`** after updating `openapi.json`
4. **Use type aliases** in feature modules for cleaner imports
5. **Document custom types** that extend generated ones

## üì¶ Dependencies

- **`openapi-typescript`** (^7.10.1) - Converts OpenAPI specs to TypeScript

## üîó Resources

- [openapi-typescript Documentation](https://github.com/drwpow/openapi-typescript)
- [OpenAPI Specification](https://swagger.io/specification/)

## üéì Example: Adding a New Feature (Fullstack Workflow)

### Scenario: Adding a "Gift Registry" feature

1. **Backend** - Add new endpoints in ASP.NET Core
   ```csharp
   // GiftsController.cs
   [HttpGet("api/weddings/{weddingId}/gifts")]
   public async Task<ActionResult<List<GiftDto>>> GetGifts(Guid weddingId)
   {
       // Implementation
   }
   ```

2. **Run Backend** - Press F5 in Rider/Visual Studio

3. **Sync Types** - Run in frontend terminal
   ```bash
   npm run sync-types
   ```

4. **Use Types** - Create frontend feature
   ```typescript
   // src/features/gifts/types/index.ts
   import type { components } from '@/types/api';

   export type GiftDto = components['schemas']['GiftDto'];
   export type CreateGiftRequest = components['schemas']['CreateGiftRequestDto'];
   ```

5. **TypeScript catches breaking changes** - If the API contract changes, you'll get compile errors immediately!

### For Team Members (who don't work on backend)

1. Pull latest code (includes updated `openapi.json`)
2. Run `npm run generate-types`
3. TypeScript will show any breaking changes

## ‚ö†Ô∏è Troubleshooting

### Cannot fetch OpenAPI from backend

**Error:** `Failed to fetch OpenAPI spec`

**Solutions:**
1. Make sure your backend is running (F5 in Rider/Visual Studio)
2. Check the backend URL is correct (default: `http://localhost:5072`)
3. Verify Swagger is enabled in your ASP.NET Core app
4. Check the Swagger endpoint path (default: `/swagger/v1/swagger.json`)
5. Try accessing the Swagger endpoint directly in your browser
6. Set `BACKEND_URL` in `.env.local` if using a different port

**Common ASP.NET Core ports:**
- 5072 (HTTPS: 7072)
- 5000 (HTTPS: 5001)
- Custom ports in `launchSettings.json`

### Types are outdated

```bash
npm run sync-types
```

### Build fails with type errors

1. Ensure `openapi.json` is up to date: `npm run fetch-openapi`
2. Regenerate types: `npm run generate-types`
3. Check if backend made breaking changes
4. Review the TypeScript errors - they often indicate API contract changes

### IntelliSense not working

1. Restart TypeScript server (VS Code/Cursor: `Ctrl+Shift+P` ‚Üí "Restart TS Server")
2. Check that `src/types/api.ts` exists and is valid TypeScript
3. Try running `npm run sync-types` to refresh everything

### Backend running on different port

Add to `.env.local`:
```bash
BACKEND_URL=http://localhost:YOUR_PORT
```
